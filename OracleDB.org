* Oracle Database
** About
- 
  オブジェクトおよびXML機能を使用するリレーショナルデータベース。

- 構成
  - ホストコンピュータ上のOracleソフトウェア
  - 物理ファイルの集合であるデータベース
  - Oracleインスタンス
    - バックグラウンド・プロセス
    - 共有メモリ―領域
  - サーバープロセス
  - Oracle Net / Oracle Netリスナー

** History/Version
*** Oracle V2(1979)
- 
  トランザクションの概念はないが、SQLを使用できた。
  Version1が存在しないのは、洗練されたDBであることを印象付けるための営業戦略と言われる。

*** Oracle version 3(1983)
*** Oracle 4(1984)
*** Oracle 5.0(1985)
*** Oracle 6.0(1988)
*** Oracle7 7.0(1992)
- 
  最終バージョンは7.3.4。
  パラレルクエリー、完全制約性、ストアドプロシージャ、データベーストリガ、
  テータベースリンク、レプリケーションなどがサポート。

*** Oracle8 8.0(1997)
- 
  オブジェクト指向やマルチメディアに対応。
  パーティショニング機能とカラム型LOB(BLOB型、CLOB型)がサポート。
  ROWIDの仕様変更により大容量のデータをサポート。
  最終バージョンは8.1.7。
  

**** Oracle 8i(R8.1.5～)(1999)
- 
  Java仮想マシンなどを組み込む。
  iはinternetの略。

*** Oracle 9i Database(2001)
- 
  RAC(Real Application Clusters)が目玉。
  最終バージョンは9.2.0.8。
  XMLの入出力など、400もの新しい特徴を有す。

*** Oracle Database 10g(2003)
- 
  グリッド・コンピューティングを目指し、グリッド技術を応用。
  gはGridの略とされる。

*** Oracle Database 11g(2007)
*** Oracle Database 12c(2013)
- 
  cはCloudの略とされる。

** Architecture
*** Process
**** About
- 
  Oracleでは複数のプロセスが実行されている。
  またWindows上では、複数プロセスでなくマルチスレッドによる動作となる。
  
- 
  MTSと呼ばれる構成にしない限り、Oracleクライアント1つに対して、サーバープロセスが1つ対応する。

**** Server Process
- 
  原則的には、SQLの結果を返すために必要なことを行う。

**** Background Process
- 
  原則的には、SQLの結果を返すために必要なこと以外を行う。

- 例
  - ora_dbwX(0や1)_XXXXXX(SID)
    データベースライター。データをディスクに書く。
  - ora_lgwr_XXXXXX(SID)
    ログライター。ログをディスクに書く。
  - ora_pmon_XXXXXX(SID)
    ピーモン。プロセスを監視し、プロセス障害を見つけた場合に掃除する。
  - ora_arcX(0や1)_XXXXXX(SID)
    アーカイバ。ログデータをアーカイブ（長期保存のため別ファイルとして保存）する。

*** Memory
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56306/memory.htm#i8451][14 メモリー・アーキテクチャ - Oracle® Database概要 11gリリース2 (11.2)]]
**** Cache
- 
  どのプロセスからも見ることができるメモリをキャッシュとしている。
  OSの共有メモリの機能を使っている。

***** Buffer Cache
- 
  書き込み用データもキャッシュに保存される。
  DBWRが定期的に変更済みデータをディスクに保存している。
  
- 
  フルスキャンデータはキャッシュヒットする可能性も少なく、他のデータも追い出してしまうため、
  Oracleでは大きな表であればバッファキャッシュに長時間留めないようにする。
  そのため、一般にフルスキャンしたデータはバッファキャッシュに載っていない、と考える。

**** PGA
- Program Global Area
  共有でないメモリの一部。
**** SGA
- System Global Area
  共有領域。
  便利だが競合が起こるため、ロックによる排他制御が必要で、性能トラブル等が起きやすい原因となっている。
**** UGA : User Global Area
**** Software Code Area

*** Block
- 
  データを管理する単位。
  I/Oの単位やバッファキャッシュはブロック単位で管理されている。
  OSのブロックとは異なり、Oracle独自のブロック。
  
  ブロックサイズは2KB, 4KB, 8KB, 16KB, 32KBといったサイズから選べる。

**** 構造
- ブロックヘッダ
  管理用の領域。データの先頭部分に格納される。
- データ
  ブロックの後ろから順に格納する。
  DELETEにより空いた領域を詰めなおすことはしない。
  
*** Optimizer
**** Cost Base
- 
  処理時間やI/O回数が最小になると考えられる処理を最上するアルゴリズム。
  コストとは、処理に必要と思われる時間、もしくはリソース使用量のこと。

***** Analyze
- 
  9i R2までは管理者が定期的、もしくは事前に行っておくことが推奨されていたが、
  10gからはOracleが自動的に行ってくれる。

- 統計情報
  - SQL文の情報
  - 表やインデックスの統計情報
  - パラメータの情報
  - システム統計情報
    - 1作業あたりにかかる時間の目安
    - oracle 10gからのデフォルト情報。
    - CPUのクロック、
**** Rule Base
- 
  10g以降はサポートしていない。

*** Status
**** OPEN
- 稼働状態。
**** MOUNT
- データファイルなどにアクセスできる状態。
- OPEN : データファイルのチェックなどをする
  alter database open
  データファイルを開いて簡単にチェックをしたり、一部のバックグラウンドプロセスを起動したりしている。

**** NOMOUNT
- バックグラウンドプロセスと共有メモリが存在する状態。インスタンスが起動した状態。
- MOUNT : 制御ファイルを読み込む
  alter database mount
  初期化パラメータに記述されている制御ファイルのパスを使用して、制御ファイルを開いて中身を読む。
  REDOログファイルやデータファイルの位置を把握する。
  なお、場所を知るだけなのでファイルが無くてもこの時点ではエラーにならない。

**** SHUTDOWN
- 停止状態。
- NOMOUNT : パラメータを読み込み、バックグラウンドプロセスの起動や共有メモリを確保する
  startup (nomount)
*** Logical Volume
**** 表領域
***** 種類
****** SYSTEM表領域
- 
  SYSTEMという表領域。データベース作成時に自動的に作成される。
  データベースのオープン中は常にオンラインになっている。

******* データ・ディクショナリ
- 
  SYSTEM表領域にはデータ・ディクショナリ表が必ず含まれる。
  データファイル1に格納される。

******* PL/SQLプロ恨むユニット
- 
  ストアドPL/SQLプログラム・ユニットのために格納されるデータは、すべてSYSTEM表領域にある。

****** SYSAUX表領域
- 
  SYSTEM表領域の補助表領域。
  多数のデータベース・コンポーネントで、デフォルトのデータ格納場所としてSYSAUX表領域が使用される。
  そのため、データベースの作成時またはアップグレード時に必ずSYSAUX表領域が作成される。
  SYSTEM表領域に常駐しないデータベース・メタデータの集中格納場所となる。

****** UNDO表領域
- 
  ロールバック情報の格納にのみ使用する特別な表領域。

****** ローカル管理表領域
- 
  表領域によるエクステント管理。
  各データファイルのビットマップが保持され、ビットマップを使用して、使用済領域と空き領域が追跡される。
  Oracle8iより提供。デフォルト。
  EXTENT MANAGEMENT句にLOCALを指定する。

- Extent Management
  AUTOALLOCATE, UNIFORMが選択可能。
  AUTOALLOCATEがデフォルト。UNIFORMを指定して均一エクステントによる管理も可能。
  さまざまなサイズのオブジェクトが表領域に含まれ、異なるサイズの多数のエクステントが必要と予測される場合、AUTOALLOCATEを選択する。
  エクステントの数とサイズが正確に予測できる場合はUNIFORMを選択する。SIZEを指定しない場合はデフォルトで1MBとなる。

****** ディクショナリ管理表領域
- 
  データ・ディクショナリによる表領域管理。
  領域の使用率の追跡をSQLディクショナリ表に依存する従来の方法で管理する表領域。
- 
  10gからシステム領域を含みすべての領域に対してローカル表領域がデフォルトとなっている。
  システム表領域をローカル管理領域で作成するとディクショナリ管理表領域は作成できなくなるため、
  10g以降は通常のデータベース作成ではディクショナリ管理表領域は作成できない。

****** 一時表領域
- 
  Oracle7.3より提供された表領域の種類。
  セッションの間のみ存続する一時データが格納される。
  中間ソート結果、一時表と一時索引、一時LOB、一時Bツリーを格納するために使用する。
  一時表領域が明示的に割り当てられていないユーザは、デフォルト一時表領域（新規インストールではTEMP）を使用する。
  
****** bigfile表領域
- 
  単一で非常に大きいデータファイル（最大40億ブロック）を持つ可能性がある表領域。
  従来のsmallfile表領域は複数のデータファイルを格納できるが、各データファイルは大きくない。

**** セグメント
**** エクステント
**** Oracleデータ・ブロック
***** PCTFREE
- 既存の行を更新する場合に備えて、空き領域として確保される割合の最小値。
  "20"と設定した場合、挿入に対して80%使用可能で、20%は更新のために保持される。
***** PCTUSED
- 新しい行をブロックに追加するときに、行データとオーバーヘッドに使用できるブロックの割合の最小値。
  PCTFREEで指定した限界値までブロックが満たされると、その割合がPCTUSEDの値を下回るまで、そのブロックを新しい行の挿入に使用できない。
*** Physical Volume
**** データファイル
**** 制御ファイル
**** REDOログ・ファイル
**** アーカイブ・ログ・ファイル
**** パラメータ・ファイル
**** アラートファイル
**** トレース・ログ・ファイル
**** バックアップ・ファイル
** Setting
*** files
**** initXXXX.ora
- 初期化パラメータファイル
- 下記のコマンドで設定値を確認可能。
  SQL> show parameter
***** Default path
- UNIX : $ORACLE_HOME/dbs/init$ORACLE_SID.ora
- Windows : ORACLE_HOME\database\initORCL.ora

**** network(folder)
***** admin
****** listener.ora
- 
  listenerの情報を記載する。
****** tnsnames.ora
- 
  接続識別子の情報を記載する。

**** oratab
- 自動起動するインスタンスの選択
- Location
  - Solaris以外
    /etc/oratab
    
- Format
  $ORACLE_SID:$ORACLE_HOME:[Y|N]
  最後の値が"Y"のものが自動起動する。
*** sql script
**** rdbms
***** admin
****** データディクショナリの作成
******* catalog.sql
- データ・ディクショナリおよびその多数のビューに対するパブリック・シノニムを作成し、PUBLICアクセス権限を与える。
******* catproc.sql
- PL/SQLに必須のスクリプトまたはPL/SQLで使用するスクリプトをすべて実行する。
******* catclust.sql
****** その他のデータ・ディクショナリ構造体の作成
******* catblock.sql
- パフォーマンス管理・SYS
  ロック関連のグラフを動的に表示するビューを作成する。
****** NOスクリプト
******* catnoadt.sql
- オブジェクト型に関連するディクショナリ・メタデータのビューおよびシノニムを削除する。
******* catnoavd.sql
- 監査メタデータのビューおよびシノニムを削除する
******* catnohs.sql
- 異機種間サービス・ディクショナリ・メタデータを削除する
******* catnoprt.sql
- パーティション表および索引に関連するディクショナリ・メタデータのビューおよびシノニムを削除する。
******* catnosvm.sql
- Oracle7 Server Managerのビューおよびシノニムを削除する
******* catnsnmp.sql
- DBSNMPユーザーおよびSNMPAGENTロールを削除する
****** アップグレード・ダウングレード
****** JavaScript
****** パッチ適用
******* catbundleapply.sql
- Call catbundle.sql to apply the Patch Set Update (PSU)
**** sqlplus
***** admin
****** glogin.sql
- サイト・プロファイル設定ファイル。
  SQL*Plusを起動すると、最初に実行される。
  次にユーザー・プロファイル設定ファイルlogin.sqlが実行される。
****** login.sql
- ユーザー・プロファイル設定ファイル
  現行のディレクトリを検索し、環境変数SQLPATHで指定したディレクトリを検索してファイルを検出する。
  glogin.sqlファイルの設定よりも優先される。
****** plustrce.sql
- 
****** pupbld.sql
- PRODUCT_USER_PROFILE表を再作成する。
****** help
******* helpbld.sql
- 新しいヘルプ表の削除および作成。SYSTEMスキーマにコマンドライン・ヘルプを手動でインストールする。
  内部的にはhlpbld.sqlを呼ぶだけ。
******* helpdrop.sql
- コマンドライン・ヘルプの表を削除する。
******* helpus.sql
- ヘルプ・データへのヘルプ表の移入。hlpbldの引数に渡す。
******* hlpbld.sql
- ヘルプ表を作成する。helpusを引数に取って実行する。
*** set
**** shmsys:~
- 
  shmから始まるものが共有メモリの設定
  
**** semsys:~
- 
  semから始まるものがセマフォの設定。

*** variables
**** ORACLE_BASE
- 
  ex) /u01/app/oracle(UNIX)
**** ORACLE_HOME
- 必須項目
  インストールされているディレクトリを指定
  ex) ORACLE_BASE/product/11.2.0/db_1
**** ORACLE_SID
- 必須項目
  初期化パラメータのファイル名に、この関数で指定されている名前が含まれる
**** PATH
- 必須項目
  ex) $ORACLE_HOME
**** Link
- [[http://www.shift-the-oracle.com/config/oracle-environment-variable.html][NLS_LANG、ORACLE_HOME、ORACLE_SID などの設定 - SHIFT the Oracle]]
** Command
*** bin
**** dbca
- 
  dbcaを起動する。

**** expdp
- 
  Data Pump。
**** impdp
**** lsnrctr
- start
  デフォルトのリスナーを起動する
- status
- stop
- help
- reload
- save_config
- exit
**** orapwd
- パスワードファイルを作成する。
  
- Usage
  opapwd file=<fname> entries=<users> force=<y/n> ignorecase=<y/n> nosysdba=<y/n>
  - file : name of password file (required)
  - password : password for SYS will be prompted if not specified at command line
  - entries : maximum number of distinct DBA (optional)
  - force : whether to overwrite existing file (optional)
  - ignorecase : passwords are case-insensitive (optional)
  - nosysdba : whether to shut out the SSYDBA logon (optional Database Vault only)
**** rman
- Recovery Manager。データベースでバックアップおよびリカバリ・タスクを実行し、バックアップ計画の管理を自動化するOracle Databaseクライアントのこと。
  
**** sqlplus
- /nolog
  ログオンを行わずにsqlplusを起動

**** tnsping
- tns用のping。
** SQL言語
- [[file:OracleDB_SQLLang.org][OracleDB_SQLLang.org]]
** PL/SQL
- [[file:OracleDB_PLSQL.org][OracleDB_PLSQL.org]]
** SQL*Plus
- 入力
  次の3タイプのコマンドが入力可能。
  - SQLコマンド
  - PL/SQLブロック
  - SQL*Plusコマンド
  
*** SQLコマンドの終了
- 
  - セミコロン(;)を入力する
  - 1行にスラッシュ(/)のみを1つ入力する
  - 空白行を入力する
*** Scriptの使用
**** Variables 変数
***** 置換変数
****** 定義
- DEFINE varname
- ACCEPT ~
- 削除
  UNDEFINE varname
****** 利用
******* &置換変数
- &VARNAME、で指定の値に置き換えられ、SQL実行される。
  例: where deptno = &deptno
- VERIFY変数
  OFFにすると、置換変数の置き換え前後の値が表示されなくなる。
  例: SET VERIFY OFF
  
******* &&置換変数
- &&変数は、SQL実行後も値が保持される。
  対して、&置換変数で置き換えられた値はSQL実行後に破棄される。
  DEFINEコマンドで確認し、UNDEFINEコマンドで破棄する。

******* 無効化
- 置換変数を無効にする
  SET DEFINE OFF
- 置換変数を他の文字に変更することなども可能(SET ESCAPE c)。
****** 種類
******* ユーザー定義変数
******* 事前定義変数
******** _CONNECT_IDENTIFIER
- 可能な宛先への接続に使用される接続識別子
******** _DATE
- 動的変数としての現在の日付、またはユーザー定義の固定文字列が含まれる。
******** _EDITOR
- EDITコマンドで使用されるエディタを指定
******** _O_VERSION
- インストールされたOracle Databaseの現行のバージョン
******** _O_RELEASE
- インストールされたOracle Databaseの完全なリリース番号
******** _PRIVILEGE
- 現在の接続での権限レベル。次のいずれかの値となる。
  - AS SYSASM
  - AS SYSBACKUP
  - AS SYSDBA
  - AS SYSDG
  - AS SYSOPER
  - 空文字(通常のユーザー接続)
******** _SQLPLUS_RELEASE
- インストールされたSQL*Plusコンポーネントの完全なリリース番号
******** _USER
- 接続に使用されるユーザー名
***** バインド変数
- 
  SQL*PlusとPL/SQLの双方で参照できる変数。
  PL/SQLに値を渡したり、結果を受け取ったりできる。
  "var[iable] 変数名 型"で宣言する。
  
- PL/SQL
  変数名の前に:(コロン)を付けて参照したり値を格納できる。
  :count:=3;
  
- SQL*Plus
  PRINTコマンドで出力可能。

*** Variables
- SQL*Plusに影響するパラメータ・環境変数
**** LD_LIBRARY_PATH
**** LOCAL
**** NLS_LANG
- グローバリゼーション機能を指定する環境変数。
  NLSはNational Language Supportの略。
  "language_territory.charset"を指定する。
  例: JAPANESE_JAPAN.UTF8, AMERICAN_AMERICA.UTF8

**** ORACLE_HOME
**** ORACLE_PATH
**** ORACLE_SID
**** PATH
**** SQLPATH
*** Commands
**** @
- 指定したスクリプトのSQL*Plus文を実行する。
**** /
- 最後に実行されたSQLコマンドまたはSQLバッファに格納されているPL/SQLブロックを実行する。
**** ACCEPT
- 構文
  ACC[EPT] variable 
    [NUM[BER] | CHAR | DATE | BINARY_FLOAT | BINARY_DOUBLE]
    [FOR[MAT] foramt]
    [DEF[AULT] default]
    [PROMPT text|NOPR[OMPT]]
    [HIDE]

- 項
  - variable
    値を格納する変数の名前を指定する。variableを指定しない場合、SQL*Plusによって変数が指定される。

  - Type
    - NUM[BER]
      variableがNUMBERデータ型に設定される。
    - CHAR
      variableがCHARデータ型に設定される。

  - Prompt
    - PROMPT text
      variableの値を受け入れる前に、画面にテキストtextを表示する。
    - NOPROMPT
      - プロンプトを表示せずに入力を待つ

  - HIDE
    - 入力された応答が表示されない。

**** CONNECT
- 
  指定したユーザ-名でOracle Databaseに接続する。

- 構文
  CONN[ECT] [{logon|/|proxy} [AS {SYSOPER|SYSDBA|SYSASM}] [edition=value]
  - logon : 
    username[/password]@connect_identifier
  - proxy :
    proxyuser[ username][/password][@connect_identifier]
  
- 項
  - /
    デフォルト・ログオンを表す。

  - AS {SYSOPER|SYSDBA|SYSASM}
    AS句を使用すると、SYSOPER、SYSDBA、またはSYSASMシステム権限が付与されているユーザーによる特権付接続が可能。

**** DEFINE
- DEF[INE] [variable] | [variable = text]
  ユーザ変数または事前定義変数を指定し、その変数にCHAR値を割り当てたり、1つまたはすべての変数の値および変数型を表示する。

**** DESCRIBE
- DESC[RIBE] objectx
  表、ビュー、ファンクション、プロシージャの定義を表示する。

**** HOST
- HO[ST]
  続けてOSのコマンドを入力することで、OSのコマンドを実行可能。

- 短縮形
  - !
    Unix系での短縮形。直後にスペースは不要で、続けて入力可能。
  - $
    Windows系での短縮形。

**** PROMPT
- PRO[MPT] [text]
  textを画面上表示する
  
**** SET
***** SET DEF[INE] {&|c|ON|OFF}
- 置換変数の接頭辞として使用する文字を、cに設定する。
  ONまたはOFFによって、置換をするかどうかを設定する。ONを設定するとデフォルトの"&"へボトル。
***** SET ECHO {ON|OFF}
- @、@@またはSTARTを使用して実行するスクリプトでコマンドをエコー表示するかどうかを制御する。
  ONを指定すると、画面にコマンドが表示される。OFFを指定すると、非表示となる。
  対話方式で入力するコマンドまたはOSからリダイレクトするコマンドの表示には影響がない。
  
***** SET ESC[APE] {\|c|ON|OFF}
- エスケープ文字として使用する文字を定義する。
  OFFを指定するとエスケープ文字の定義が解除される。ONを指定すると、使用可能となり、設定値はデフォルトの"\"に戻る。
  
***** SET LIN[ESIZE]
- 1行に表示する文字の合計数を設定する。
***** SET PAGES[IZE]
- 各出力ページの行数を設定する。
  0に設定すると、ヘッダ、ブレーク、タイトル、初期空白行およびその他の情報をすべて費用時にできる。
***** SET VER[IFY] {ON|OFF}
- 
  置換変数を値と置き換える前後に、SQL文またはPL/SQLコマンドのテキストをリスト表示するかどうかを制御する。
**** SHUTDOWN
- 
  接続の終了を待つ。

- transactional
  トランザクションが終わるまで待つ。
  トランザクションが終わったら接続を切る。

- immediate
  接続終了をまたず、コミットされていないデータは失われる。
  変更済みデータはデータファイルに書き込まれる。

- abort
  接続終了をまたず、コミットされていないデータは失われる。
  変更済みデータはデータファイルに書き込まれない。
**** SPOOL
- 構文
  SPO[OL] [file_name[.ext] [CRE[ATE] | REP[LACE] | APP[END]] | OFF | OUT]
- 項
  - CRE[ATE]
    指定した名前でファイルを新規作成する。
  - REP[LACE]
    デフォルトの動作。既存のファイルの内容を置換する。ファイルが存在しない場合、ファイルが作成される。
  - APP[END]
    指定したファイルの終わりに、バッファの内容を追加数r
  - OFF
    スプールを停止する。
  - OUT
    スプールを停止して、ファイルをコンピュータの標準プリンタに送る。
  - (指定なし)
    現行のスプール状態を表示する。

**** STARTUP
- 
  SQL*Plusを起動する

- 構文
  - STARTUP options | upgrade_options
  - options :
    [FORCE] [RESTRICT] [PFILE=filename] [QUIET] [MOUNT [dbname] | [OPEN [open_options] [dbname]] | NOMOUNT ]
  - open_options :
    READ {ONLY | WRITE [RECOVER]} | RECOVER
  - upgrade_options :
    [PFILE=filename] {UPGRADE | DOWNGRADE} [QUIET]

- 項
  - FORCE
    再起動する前に現行のインスタンスをABORTモードのSHUTDOWNで停止しておく必要があり、現在のインスタンスが実行されている場合はエラーとなる。
    FORCEが指定されている場合は実行される。デバッグ中及び異常な環境下で有効なオプションで、通常は仕様を控えるべき。
  - PFILE=filename
    インスタンスの起動中に使用されるクライアント・パラメータ・ファイルを指定する。
    PFILEの指定を省略すると、デフォルトのサーバー・パラメータ・ファイル(spfile)にアクセスしようとする。spfileが見つからないとデフォルトのpfileにアクセスしようとする。
    デフォルトファイルはプラットフォーム固有でhとなる。
    例 : UNIX : $ORACLE_HOME/dbs/init$ORACLE_SID.ora、Windows : ORACLE_HOME\database\initORCL.ora
    
  - Mount
    - MOUNT dbname
      オープンしないでマウントする。
    - OPEN
      マウントおよびオープンする。
    - NOMOUNT
      停止状態からNOMOUNT状態になる。
      MOUNTまたはOPENと同時には指定できない。
      その後変更する場合は、alter database mount; alter database open;など。

**** VARIABLE
- VAR[IABLE] [variable [type]]
  引数なしでVARIABLEを指定すると、セッション内で宣言されているすべての変数が表示される。
  変数名のみを指定すると、その変数が表示される。
  
  ストアドプロシージャに対するパラメータとして使用される。また、無名PL/SQLブロックの中で直接参照できる。

**** WHENEVER OSERROR
- 
  OSのエラーが発生した場合に、指定した操作を実行する。
- 構文
  - WHENEVER OSERROR {EXIT [SUCCESS|FAILURE|n|variable|:BindVariable] [COMMIT|ROLLBACK] | CONTINUE [COMMIT|ROLLBACK|NONE]}
- 項
  - EXIT [SUCCESS|FAILURE|n|variable|:BindVariable]
    エラーが検出されたらすぐに終了するように指定する。
  - CONTINUE
    EXITオプションをオフにする。
  - 動作
    - COMMIT
      終了または継続する前にCOMMITを実行し、データベースに対する保留中の変更を保存するように指示する。
    - ROLLBACK
      終了前にROLLBACKを実行するようにする。
    - NONE
      何の操作もしない。
**** WHENEVER SQLERROR
- SQLコマンドまたはPL/SQLブロックでエラーが発生した場合に、指定した操作を実行する。
- 構文
  WHENEVER SQLERROR {EXIT [SUCCESS|FAILURE|WARNING|n|visible|:BindVariable] [COMMIT|ROLLBACK] | CONTINUE [COMMIT|ROLLBACK|NONE]}
- 項
  - EXIT [SUCCESS|FAILURE|n|variable|:BindVariable]
    エラーが検出されたらすぐに終了するように指定する。
  - CONTINUE
    EXITオプションをオフにする。
  - 動作
    - COMMIT
      終了または継続する前にCOMMITを実行し、データベースに対する保留中の変更を保存するように指示する。
    - ROLLBACK
      終了前にROLLBACKを実行するようにする。
    - NONE
      何の操作もしない。  
*** Restriction
- 
  |----------------------+------------|
  | 項目                 | 制限       |
  |----------------------+------------|
  | ユーザー名           | 30バイト   |
  | 置換変数名の長さ     | 30バイト   |
  | 置換変数値の長さ     | 240文字    |
  | コマンドラインの長さ | 2500文字   |
  | 最大PAGESIZE         | 50,000行   |
  | 合計行幅             | 32,767文字 |
  | 最大ページ数         | 99,999     |
  |----------------------+------------|

- 
  [[http://docs.oracle.com/cd/E16338_01/server.112/b56314/apa.htm][A SQL*Plusの制限 - SQL*Plus®ユーザーズ・ガイドおよびリファレンス リリース11.2]]

*** Arguments
- 
  ファイル名の後にスペースを挟んで引数を列挙する。
  内部では&1, &2などの形で受け取れる。
  
- 
  [[http://www.shift-the-oracle.com/sqlplus/tutorial/sqlplus-script-parameter.html][SQL*Plus の実行スクリプトをパラメータ付きで起動する - SHIFT the Oracle]]

*** Security
**** PRODUCT_USER_PROFILE表
- PUP表
  GRANTとREVOKEコマンド、およびユーザー・ロールによるユーザー・レベルのセキュリティを補う。
  特定のSQLおよびSQL*Plusコマンドをユーザー単位で使用禁止にできる。
*** Link
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56314/toc.htm][目次 - SQL*Plusユーザーズ・ガイドおよびリファレンスリリース11.2]]
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56314/ch_twelve001.htm#BACDBGBC][SQL*Plusコマンド一覧 - SQL*Plusユーザーズ・ガイドおよびリファレンスリリース11.2]]
** Reference
- [[file:OracleDB_Reference.org][OracleDB_Reference.org]]
** Interface
*** SQL*Plus
- 
  SQLを実行するためのインターフェイスユーティリティ。
  アプリケーションから呼ぶことはほとんどなく、人手によるデータベースの管理をするために使う。

*** JDBC
- Java Database Connectivity
*** ODBC
- Java Database Connectivity
*** OO4O
- Oracle Object For Ole
*** Pro*C
- 
  Oracle向けC言語コンパイラ。

** Manage
*** ユーザ分類
**** データベース管理者
***** タスク
****** データベース・サーバ・ハードウェアの評価
****** Oracle Databaseソフトウェアのインストール
****** データベースの計画
****** データベースの作成とオープン
****** データベースのバックアップ
****** システムユーザの登録
****** データベース設計の実装
****** 実行データベースのバックアップ
****** データベースのパフォーマンス・チューニング
****** パッチのダウンロードとインストール
****** 追加ホストのロール・アウト
**** セキュリティ管理者
**** ネットワーク管理者
**** アプリケーション管理者
**** データベースユーザ
*** 管理ロードマップ
**** インスタンスの起動
**** ネットワーク環境構成
**** 記憶域構造の核にｎ
**** メモリー管理
**** ユーザ管理
**** スキーマ・オブジェクトの管理
**** バックアップ・リカバリの実行
**** リカバリ設定の構成
**** データベースの監視およびチューニング
**** 問題の調査、報告、解決
**** ソフトウェアの管理
*** SQLの発行
- SQL*Plus
- Oracle Enterprise Manager
- SQL Developer

** Security
*** 事前定義ユーザ
**** 事前定義された管理アカウント
***** ANONYMOUS
- Oracle XML DBへおHTTPアクセスを許可するアカウント。
  EPG(Embedded PL/SQL Gateway)をデータベースにインストールするときに、APEX_PUBLIC_USERアカウントの代わりに使用される。
***** CTXSYS
- Oracle Textを管理するためのアカウント。
***** DBSNMP
- データベースの監視及び管理を行うためにOracle Enterprize ManagerのManagement Agentのコンポーネントによって使用されるアカウント。
***** EXFSYS
- Rules Manager機能およびExpression Filter機能と関連頭消されるEXFSYSスキーマにアクセスするために内部で使用されるアカウント。
  (どちらの機能も12cで終了)
***** LBACSYS
- Oracle Label Security(OLS)を管理するためのアカウント。Label Securityオプションをインストールするときのみ作成される。
***** MDSYS
- Oracle SpatialおよびOracle Multimedia Locator管理者アカウント。
***** MGMT_VIEW
- Oracle Enterprise Manager Database Controlで使用されるアカウント。
  
***** OLAPSYS
- OLAPカタログ(CWMLite)を所有するアカウント。非推奨だが下位互換のために保持されている。
***** ORDDATA
- Oracle Multimedia DICOMのデータモデルが含まれている。
***** OWBSYS
***** ORDPLUGINS
- Oracle Multimediaユーザ。Oracleおよびサード・パーティに提供されたプラグインはこのスキーマにインストールされている。
***** ORDSYS
- Oracle Multimedia管理者アカウント。
***** OUTLN
***** SI_INFORMTN_SCHEMA
- SQL/MM Still Image Standard向けの情報ビューを保持しているアカウント。
  
***** SYS
- データベース管理タスクの実行に使用されるアカウント。
***** SYSMAN
- Oracle Enterprise Managerデータベースの管理タスクの実行に使用するアカウント。
  SYSおよびSYSTEMでもこれらのタスクを実行できる。
***** SYSTEM
- Oracle Databaseのデフォルトの汎用データベース管理者アカウント。
  本番環境ではSYSTEMを使用せず、個々のデータベース管理者アカウントを作成するべき。
***** WK_TEST
***** WKSYS
***** WKPROXY
***** WMSYS
- Oracle Workspace Managerのメタデータ情報の格納に使用されるアカウント。
***** XDB
- Oracle XML DBデータおよびメタデータの保存に使用されるアカウント。
**** 事前定義された非管理アカウント
***** APEX_PUBLIC_USER
- Oracle Database Application Expressのアカウント。
  データベース・アクセス記述子(DAD)でデータベースに接続するために使用するOracleのスキーマの指定に使用する。
***** DIP
- 
  Oracle Directory Integration and Provisioning(DIP)のアカウント。
  
***** FLOWS_040100
***** FLOWS_FILES
***** MDDATA
***** ORACLE_OCM
- Oracle Configuration Managerと使用するアカウント。
  現在のインスタンスの構成情報をMy Oracle Supportと関連付けることができる。
***** SPATIAL_CSW_ADMIN_USR
***** SPATIAL_WFS_ADMIN_USR
***** XS$NULL
- セッション内にユーザーが存在しないことを表す内部アカウント。
  ユーザーでないため、Oracle Databaseインスタンスによってのみアクセスできる。権限はない。
**** 事前定義されたサンプル・スキーマ・ユーザアカウント
***** BI
- サンプルスキーマに含まれるBI(Business Intelligence)スキーマを所有するアカウント。
***** HR
- HR(Human Resources)スキーマを管理するためのアカウント。
  企業の従業員や施設に関する情報。
***** OE
- OE(Order Entry)スキーマを管理するためのアカウント。
  製品のインベントリや様々なチャネルによる製品の売り上げ
***** PM
- PM(Product Media)スキーマを管理するためのアカウント。
  企業が販売した各製品の説明と詳細情報
***** IX
- IX(Information Exchange)スキーマを管理するためのアカウント。
  B2Bアプrケーションを介した発送を管理
***** SH
- SH(Sales)スキーマを管理するためのアカウント。
  ビジネス上の決断を容易にするビジネス戦略を格納
**** その他
***** APPQOSSYS
- Oracle Quality of Service Managementで必要なすべてのデータおよびメタデータの格納および管理に使用される。
  
***** TSMSYS
- 透過的なセッション移行(Transparent Session Migration: TSM)に使用されるアカウント。
***** PERFSTAT
- Oracle Statspackに関するユーザ。
**** 旧資料参照
***** DMSYS
- データマイニングアカウント。
  10gまでは存在したが、11gには存在せず、代わりにSYSを使うこととなる。
  [[http://docs.oracle.com/cd/E18283_01/datamine.112/e16807/upgrade_odm.htm][6 Upgrading Oracle Data Mining - Oracle® Data Mining Administrator's Guide 11g Release 2 (11.2)]]

**** Link
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56296/tdpsg_user_accounts.htm#BABGEGFI][Oracle Databaseから提供される事前定義されるユーザー・アカウント - Oracle® Database 2日でセキュリティ・ガイド 11g リリース2(11.2)]]

** Installation
*** Class
**** Desktop Class
- ラップトップコンピュータ用。
**** Server Class
- 拡張構成オプションにアクセスする必要がある場合、このクラスを選択する。
*** Install Type
**** Enterprise Edition
- 完全な機能。
  ミッションクリティカル、OLTP、データウェアハウス環境。
**** Standard Edition
- ワークグループや部門レベル、もしくは中小企業用。
**** Standard One Edition
- ワークグループ、部門、もしくはWebアプリケーションに最適。
**** Personal Edition
- Windowsのみ。
  Enterprise Editionと同様のソフトウェアだが、シングル環境のユーザ開発環境とデプロイメントkン今日のみサポート。
*** 拡張インストール
**** 製品の言語
**** データベース構成タイプ
- 汎用目的/トランザクション処理
- データ・ウェアハウス
**** データベース構成オプション
**** データベース管理オプション
- 
  Oracle Enterprise Managerを使用して、集中管理するかローカル管理するかを指定する。
**** リカバリ・オプション
**** スキーマ・パスワード
**** オペレーティング・システム・グループ

*** DB作成
**** CREATE DATABASE
***** 1.インスタンス識別子(SID)の指定
***** 2.必要な環境変数が設定されていることの確認
***** 3.認証方式の選択
***** 4.初期化パラメータファイルの作成
***** 5.(Windows)インスタンスの作成
***** 6.インスタンスへの接続
***** 7.サーバー・パラメータ・ファイルの作成
***** 8.インスタンスの起動
***** 9.CREATE DATABASE文の発酵
***** 10.追加の表領域の作成
***** 11.スクリプトの実行によるデータ・ディクショナリ・ビューの作成
*** Install Log
**** 2016/6/11 11c
- http://docs.oracle.com/cd/E16338_01/install.112/b56277/toc.htm
  
- 6 カーネルパラメータの値が結構違う。とりあえずスルーします。
  /etc/sysctl.confを編集する、とのこと。
  ⇒結局10で怒られたので編集した。

- 7 DISPLAYの設定をして、xhostが利用できるようにしたが、
  今回は色々変更した後で、別に変更しなければ接続できたことに気付いた。
  ⇒oracleでxhost localhost、でOK?
  ⇒違う。rootでxhost local:userを設定。
  oracleユーザでDISPLAYを規定値":0.0"に戻した後、runinstallerを実行。

- 10 
  - emailは入力せず。クリティカルイッシューでメールよこさんぞ、と言われる。
  - Skip software updateとしてしまう。
  - Createする
  - Server Classを選択
  - RACにしようとしたら怒られる。Singleに。
  - Typical Installを行う。
  - 詳細
    - Oracle base : /oracle/app/oracle
    - Software location : /oracle/app/oracle/product/11.2.0/dbhome_1
    - Storage Type : File System
      - Database file location : /oracle/app/oracle/oradata
    - Database edition : Enterprise Edition
    - OSDBA Group : dba
    - Global database name : orcl.localdomain
    - Password : yasutake
  - Inventory
    - Directory : /home/oracle/app/oraInventory
    - Group : oinstall
  - Prerequisite Check
    - Passせず。
      - Phisical Memory
      - OS Kernel Parameters
        - semmsl
        - semmns
        - semmni
        - shmmni
        - ip_local_port_range
      - Package
        - elfutils-libelf-devel-0.97
        - gcc-c++-3.4.5(x86_64)
        - libstdc++-devel-3.4.6(x86_64)
        - pdksh-5.2.14
    - 以下についてIgnore
      - Checks
        - Hard Limit maximum open file descriptors : 65536 -> 4096
        - Hard Limit maximum user processes : 16384 -> 5110
        - Soft Limit maximum user processes : 2047 -> 1024
        - Package : pdksh-5.2.14
  - rootで以下を実行しろ、とのこと。
    - /home/oracle/app/oracInventory/orainstRoot.sh
    - /home/oracle/app/oracle/product/11.2.0/dbhome_1/root.sh
  - current home is not registered in the central inventory on this system. OK? -> Yes
**** 2016/6/14
- パスが/home/oracleになっていたため再作成。
  - plcn.localhost
  - デフォルトのユーザはSYSTEM、だった。
***** DBCA
- General
- test.local_domain
- local management
- すべてyasutake(SYS, SYSTEM, DBSNMP, SYSMAN)
** Tools
*** Automatic Workload Repository(AWR)
- 自動ワークロード・リポジトリ
  Oracle Databaseの稼働状況とワークロード情報のスナップショットを自動的に収集/管理する機能。
  10gより提供された機能。
*** Database Upgrade Assistant
- 既存のDBを新しいリリースのDBへアップグレードする際に使うツール
*** Oracle Application Express
- Oracle APEX
  Oracle DatabaseのためのWebアプリケーション開発ツール。
  
*** Oracle Configuration Manager
- クライアントの構成情報の収集と、この情報のOracleリポジトリへのアップロードに使用される。
*** Oracle Data Mining(ODM)
- Oracleデータベースにデータ・マイニング機能を組み込む。
  
*** Oracle Data Pump
**** About
- 
  10gより導入された。
  従来のエクスポート/インポート(exp/impコマンド)と目的は同じく論理バックアップの取得で、データベース間のデータ移動を可能とする。
  従来のexp/impは基本的にユーティリティ側で処理されるが、Data Pumpはデータベースサーバー側でジョブとして管理・処理され、
  「パフォーマンス向上」と「管理性の向上」が得られる。

**** Architecture
- 
  1) コマンドライン・クライアント expdp/impdp
  2) PL/SQLパッケージ DBMS_DATAPUMP (Data Pump API)
  3) PL/SQLパッケージ DBMS_METADATA (メタデータAPI)

**** 利用例
- 
  - 事前準備
    - Directoryの作成
      create or replace directory TEST_DIR as '/home/test';
    - Directoryの権限付与
      grant read, write on directory TEST_DIR to SCOTT;
  - EXPDP
    ex) expdp scott/tiger directory=test_dir tables=emp
  - IMPDP
    ex) impdp scott/tiger directory=test_dir dumpfile=exp.dmp tables=emp
        impdp scott/tiger directory=test_dir dumpfile=exp.dmp sqlfile=ddl.sql

**** Options
***** MODE
****** FULL 全体エクスポート・モード
- FULL=Yでデータベース全体を指定
****** SCHEMAS スキーマ・モード
- スキーマ名を指定
****** TABLESPACES 表領域モード
- 表領域名を指定
****** TABLES 表モード
- テーブル名を指定
****** TRANSPORT トランスポータブル表領域モード
***** FILTER
****** Data filter
- 
  Use "QUERY" or "SAMPLE" parameter.

****** Metadata filter
- 
  Use "EXCLUDE" or "INCLUDE" parameter.

***** Export
****** ESTIMATE_ONLY
- ESTIMATE_ONLY=yで、領域の見積もりのみ実施
***** Import
****** SQLFILE
- SQL DDLの書き込み先ファイルを指定する。import。
***** Both
****** CONTENT
- CONTENT=ata_only
  表のデータのみ
- CONTENT=metadata_only
  表の定義のみ
- CONTENT=all(default)
  表のデータと定義の両方
****** DUMPFILE
- ダンプファイル名を指定する。デフォルトは"EXPDAT.DMP"
****** EXCLUDE
- default : null
  一部のオブジェクトを除く。

- object_type
  以下で有効な値を確認可能。
  - 全体モード : DATABASE_EXPORT_OBJECTS
  - スキーマモード : SCHEMA_EXPORT_OBJECTS
  - 表および表領域モード : TABLE_EXPORT_OBJECTS
  
****** INCLUDE
- default : 
****** LOGFILE
- ログファイル名を指定する。デフォルトは"export.log","import.log"
****** NOLOGFILE
- NOLOGFILE=yでログファイルの出力を行わない
**** Link
- 
  [[http://otndnld.oracle.co.jp/products/database/oracle11g/pdf/datapump11g2007_quickstart.pdf][Oracle Data Pump クイック・スタート - Oracle ホワイト・ペーパー]]
  [[https://blogs.oracle.com/oracle4engineer/entry/data_pumpexpdpimpdp][Data Pump(expdp/impdp)の使い方～エクスポート／インポート、データ移動、論理バックアップ - オラクルエンジニア通信]]
  [[http://docs.oracle.com/cd/E16338_01/server.112/b56303/part_dp.htm][Oracle Data Pump - Oracle® Databaseユーティリティ 11gリリース2 (11.2)]]
*** Oracle Database Configuration Assistant(DBCA)
- テンプレートからデータベースを作成したり、独自のデータベースを作成するユーティリティ。
**** データベース作成
***** 起動
- shellより"dbca"
***** Templates
- General, Data Warehouseなどから選択
***** Identification
- Global Database Nameを指定
***** Management Option
- Enterprise Managerで管理するか否か設定する。
  集中管理かローカル管理かを選択する。
***** Credentials
- パスワードなどを指定する
***** File Locations
- テンプレートの位置
- すべてに対して共通の位置。指定が必要。
- Oracle Managed Files。
***** Recovery Configuration
-
***** Content
- サンプルスキーマ
- カスタムスクリプト
***** Parameters
- Memory
- Sizing
- Character Sets
  - AL32UTF8は、Oracleで使用しているUTF-8エンコードの名前。
- Connection Mode
  - Dedicated Server Mode 専用サーバー・モード
    各ユーザ・プロセスで専用のサーバ・プロセスが使用できる。
    クライアント総数が50以下など、少ないと予想される場合にこのオプションを指定する。
  - Shared Server Mode 共用サーバー・モード
    リソース・プールを複数のクライアント接続で共有できる。
***** Storage
***** Create
**** DB構成変更
**** DB削除
**** テンプレート管理
***** タイプ
****** シード
- 
  拡張子：.dbc
  既存のデータベース（シード・データベース）の構造および物理データファイルの両方が含まれる。
  
****** 非シード
- .dbt
*** Oracle Database Quality of Service Management
- Oracle Database QoS Management
  システム全体のワークロード・リクエストを監視する自動化されたポリシーベースの製品。
  アプリケーション間で共有されるリソースを監視し、システム構成を調整して、アプリケーションの実行をビジネスに必要なパフォーマンス・レベルに維持する。
*** Oracle Directory Integration and Provisioning Server
- Oracle DIP
  
*** Oracle Enterprise Manager
**** Database Control
- 
  Webベースのインターフェース。
  インストール、データベースを作成（アップグレード）してネットワークを構成すると使用可能に。
**** Cloud Control
- 
  OracleおよびOracle以外のテクノロジを実行するシステムを含むITインフラストラクチャ全体に対し、
  集中化された監視機能、管理機能およびライフ・サイクル管理機能を提供するシステム管理ソフトウェア。
  
***** Components

****** Oracle Management Agent
- 管理エージェント
  組み込まれたソフトウェア・コンポーネントで、Enterprise Managerシステムで管理対象外ホストを管理対処ホストに変換する。
  プラグインと連携することにより、管理対象ホスト上で実行されているターゲットを監視する。

****** Oracle Management Service
- OMC
  管理エージェントおよびプラグインと連携し、ターゲットを検出して、その監視及び管理を行い、
  将来の分析のために収集した情報をリポジトリ内に格納するWebベースのアプリケーション。
  
****** Oracle Management Repository
- 管理リポジトリ
  管理リポジトリは、管理エージェントが収集したすべての情報が保存される場所。
  
****** Plugins
****** Console
**** Grid Control
-
***** Components
****** Oracle Management Agent
- 管理エージェント
****** Oracle Management Service
- OMS
****** Oracle Management Repository
- 管理リポジトリ
****** Console

*** Oracle Expression Filter
- RUL
  Expression FilterとObject Relationalの機能を使用して、特殊な目的のルールエンジンの機能を提供する。
  12cでサポートが終了。
*** Oracle Identity Management
- 
  アプリケーションとディレクトリ(サード・パーティのLDAPディレクトリを含む)をOracle Internet Directoryに統合して、管理作業にかかる時間とコストを削減できる。

*** Oracle Internet Directory
- Oracleコンポーネントとサード・パーティのアプリケーションによって、ユーザIDおよび資格情報が格納され、アクセスされるリポジトリ。
*** Oracle Label Security
- 
  データベース表に対して行レベルのセキュリティを提供する。
  データ行は、個々の行にラベルを付けることで保護される。
  ニーズに応じて行を様々なセキュリティ・レベルに割り当てることができる。

**** Components
***** Label
****** Level
****** Compartment
****** Group
***** Policy
*** Oracle Locator
- Oracle Spatialで使用可能な主要な機能およびサービスを提供する。
  通常、インターネットおよびワイヤレス・サービス・ベースのアプリケーションおよびパートナ・ベースのGISソリューションをサポートする貯めに必要な、重要な機能を提供する。
*** Oracle Multimedia
- イメージ、オーディオ、ビデオまたは疎オン他の異機種間メディアデータを、他の企業情報と統合したフォーマットで格納、管理および検索する機能。
*** Oracle Multimedia DICOM
- Digital Imaging and Communications in Medicine(DICOM)は医用画像の標準規格。
  
*** Oracle Net Services
- https://docs.oracle.com/cd/E16338_01/network.112/b56288/toc.htm
*** Oracle Rules Manager
- EXF
  アプリケーション開発者が条件式をリレーショナル表の1つ以上の列に格納し、索引を付けて評価できるようにするRules Managerのコンポーネント。
  12cでサポートが終了。
*** Oracle Spatial
- Oracleのファンクションとプロシージャを統合した製品で、空間データの格納、アクセスおよび分析を短時間で効率的に処理することを目的としている。
*** Oracle Statsack
- 
  パフォーマンス上の問題点を診断するツール。
  Oracle 8iから提供されている。
  10gでは自動ワークロードリポジトリ(AWR)が提供されたため、マニュアルから削除されているが、能自体は存続している。
*** Oracle SQL Developer
- GUIツール。
  $ORACLE_HOME/sqldeveloper中に、sqldeveloper.shがあるので起動。
  xが利用できる必要がある。
- 
  http://www.oracle.com/technetwork/jp/developer-tools/sql-developer/downloads/index.html

*** Oracle Text
- 
  全文検索およびドキュメント分類のためのエンジン。
  検索対象の文書の「本文」そのものを検索対象とする。

*** Oracle Universal Installer(OUI)
- Install用ユーティリティ
*** Oracle Workspace Manager
- 作業領域を作成し、バージョンが異なる表の行の値を、異なる作業領域に簡単にグループ化できるインフラストラクチャを提供する。
  ユーザは、古いデータを保持しながら、更新するデータの新しいバージョンを作成することができる。
*** Oracle XML DB
- XMLデータの格納、生成、アクセス、検索、検証、変換、拡張および索引付などの高パフォーマンスの処理に関連する一連のOracle Databaseテクノロジー。
  SQLとXMLの両方のデータ・モデルの相互運用を可能にすることで、ネイティブなXMLサポートを提供する。
*** Recovery Manager
- https://docs.oracle.com/cd/E16338_01/backup.112/b56269/toc.htm
** Error
*** ORA-00942
- 該当の表またはビューが存在しない場合や、表やビューに対するアクセス権限が不足している場合に発生する。
*** ORA-00972
- 識別子が長すぎる。
  列名、テーブル名は30文字までとのこと。
*** ORA-01031
- 権限が不足している。
  ユーザの権限等を見直す必要がある。
*** ORA-01659
- 十分な容量がありません。
*** ORA-22868
- LOB列のセグメントがあるが、表セグメントは異なる表領域にある
  削除しようとした表領域には、表のLOB列のセグメントがあるが、表セグメントがない。
  表を削除してから、表領域の削除を再実行する必要がある。

** Glossary
*** Oracle ASM
- Oracle Automatic Storage Management
  データベースファイルの配置とネーミングを自動的に管理する。
  多数のディスクを持つ華僑では、管理が簡単になり、パフォーマンスが向上する。
  
*** SID
- System Identifier
  システム識別子。インスタンスを区別するために使用する一意の識別子。

*** グローバルデータベース名
- 
  その他のデータベースと一意に識別されるデータベースの完全名。
  database_name.database_domainの形式。

*** Schema スキーマ
- 
  データの論理構造の集合。
  1ユーザは1スキーマを必ず所有し、デフォルトで自動的にユーザ名と同じスキーマ名が割り当てられる。
  ユーザなしのスキーマ、スキーマなしのユーザは作成できない。
  
*** SYNONYM シノニム
*** TNS
- Transparent Network Substrate
  データベースの接続や複数ノード間のメッセージのやり取りを単一の共通インターフェースで提供している技術。
  Oracle Net Foundationレイヤーに組み込まれている。
  
*** Database Access Descriptor
- データベースアクセス記述子
  
*** DIRECTORY ディレクトリ
- 
  コンピュータの物理的なディレクトリをSQLやPL/SQLに直接指定することがないように、Oracle城で別名を付けて管理する。
  物理ディレクトリを変更したくなった場合に、SQLやPL/SQLを変更しなくても済む。
  [[http://q.hatena.ne.jp/1093325780][Oracleのディレクトリオブジェクトは何のために存在していますか。どのようなときにどう使うと便利なのですか？ - 人力検索はてな]]

*** 引用識別子/非引用識別子
- 
  非引用識別子は大/小文字が区別されず、すべて大文字として解析される。
  引用識別子は大/小文字が区別される。
  [[http://otndnld.oracle.co.jp/document/products/oracle11g/111/doc_dvd/server.111/E05750-03/sql_elements.htm#57456][スキーマオブジェクト名および修飾子 - Oracle Database SQL言語リファレンス 11g リリース1（11.1）]]

*** PFILE, SPFILE
- PFILE
  初期化パラメータファイル
  テキストファイル。設定内容を手動で変更可能。
  ALTER SYSTEMコマンドで変更した場合、起動中のインスタンスのみに変更が適用されるため、変更した値はインスタンス再起動により失われる。
- SPFILE
  サーバー・パラメータファイル
  バイナリファイル。alter sysetmコマンドで編集し、効果は永続する。9iから導入された。
- 起動時の優先順位
  1. 起動時指定のpfile
  2. spfileSID.ora
  3. spfile.ora
  4. initSID.ora
  5. init.ora
*** PSR, CPU, PSU, PSE
- PSR, Patch Set Release
  安定したパッチセットで、重要度の高いバグをフィックス可能。PSUやCPU適用の前提条件であることも多い。
- CPU, Critical Patch Update
  四半期ごとに提供される、セキュリティ修正を中心とした重要な修正の集積体。
- PSU, Patch Set Update
  CPUの修正を含み、かつ適用が推奨される重要な修正を含んだ集積パッチ。CPUと同様四半期ごとに提供される。
- PSE, Patch Set Exception
  別名個別パッチ。
  一つの不具合に対する修正パッチ。リリースタイミングは不定期。
*** PROFILE
- データベース・リソースの制限の集合。
  
*** 自動化メンテナンス・タスク、AUTOTASK
- データベースのメンテナンス操作を実行するために、一定の間隔をおいて自動的に開始されるタスク。
  問い合わせオプティマイザのスキーマ・オブジェクトに関する統計を収集するタスクなどはその一例。
  
- 3種類の自動化メンテナンス・タスクが事前定義されている。
  - 自動オプティマイザ統計収集
  - 自動セグメント・アドバイザ
  - 自動SQLチューニング・アドバイザ
**** メンテナンス・ウィンドウ
- 自動化メンテナンス・タスクが実行される連続した時間間隔。
  MAINTENANCE_WINDOW_GROUPという名前のウィンドウ・グループに属するOracle Scheduleウィンドウ。
*** コンポジット変数
- 
  コレクションとレコードという、2種類のコンポジット変数がある。
  - コレクション
    常に同じデータ型であり、"要素"と呼ばれる。
  - レコード
    データ型が異なる場合があり、"フィールド"と呼ばれる
*** 行連鎖・行移行
- 無駄なブロックI/Oが多くなりパフォーマンスに影響する。
  [[http://www.insight-tec.com/mailmagazine/ora3/vol440.html][行移行・行連鎖に関する検証 その１ - InsightTechnology]]
**** 行移行
- 1つのデータ・ブロックに収まっていた行が更新されて、行全体の長さが増加したが、更新後の行を保持する十分な空き容量がない場合、
  行全体が新しいブロックに収まることを前提として、行全体が新しいデータ・ブロックに移動される。
  移行された行の元の行断片には、行の移行先の新しいブロックへのポインタまたは「転送先アドレス」が含まれる。そのためROWIDは変わらない。
**** 行連鎖
- 最初に行を挿入するとき、大きすぎて1つのデータ・ブロック内に収まらない場合、
  その行のデータは、セグメント用に確保された1つ以上のデータ・ブロックの連鎖に格納される。
** Memo
*** 他システムとの違い
**** 空文字/Null
- 
  可変長文字列において空文字列とNULLを区別しない。
  （正確には空文字列がNULLとして扱われる）

**** 比較演算子
- 
  通常の演算子として認識されず、WHERE句の中でしか利用できない

**** FROM句
- 
  表を必要としないSQLでも、必ず何らかの表を参照するFROM句を書かなければならない。

**** マルチバイト文字
- 
  テーブル名や列名、その別名にマルチバイト文字を使用する場合必ず""で囲む必要がある。
  困難なため、実際には英数字および記号（_ $ #）のみを使用することが推奨される。
*** DUAL表
- 
  1列しか存在しない特別な表。
  SYSDATEやUESRなど、表を適用せずとも値を返す演算に対してSELECTを行う場合に使われる。
  VARCHAR2(1)のDUMMYという列があり、レコード値は'X'となっている。

- 
  Oracle 10gでは、DUAL表そのものは存在しているものの、最適化により実際にはアクセスしないようになっている。

*** RAC
- Oracle Real Application Clusters
  
*** 読み込み時の情報
**** sequential read
- 
  ランダムアクセス時。
  単一ブロック読み込みのため、読み込んだデータが（1ブロックなので当然）メモリ上で連続する。
  そのため、"sequential"と表示される。

**** scattered read
- 
  シーケンシャル読み込み時。
  複数ブロックを読み込み、それらは連続していないので、"scattered"と表示される。
*** インスタンス
- 
  Oracleでは、管理の単位として「インスタンス」という用語を用いる。
  意味は「バックグラウンドプロセス群＋共有メモリ」のこと。
  データベースを管理しているもの、というイメージであり、データベースそのものではない。
  通常インスタンスとデータベースは1:1で対応するが、RACを使用している場合は異なる。
*** インスタンスリカバリ
- 
  abrotオプションでshutdownした場合には変更済みデータを書き込まず終了するが、
  REDOログファイルのデータを使用して、データを復旧させる。
  この作業を「インスタンスリカバリ」という。
  この作業は、起動時にOracleが勝手に行う。
  Oracleが異常終了した場合もインスタンスリカバリが行われる。
  ただし、キャッシュ上の変更済みデータが失われただけでなく、データファイルが存在しないなどのファイルに関する障害がある場合は、
  本格的な復旧作業が必要。
  
*** sqlplusでヒストリ利用
- 
  "readline-devel"を入れて、rlwrapというツールを使ってwrapする。
  
- 
  [[http://utopia.knoware.nl/~hlub/uck/rlwrap/][rlwrap]]
  [[http://d.hatena.ne.jp/yohei-a/20101021/1287677679][sqlplus で bash みたいにヒストリを呼び出したりできたらいいな - ablog]]

*** 実行スクリプトファイルを指定してSQL*Plusを起動
- 
  スペースを入れて、@xxx.sqlを指定する。
  スペースを入れない場合はネットサービス名となる。
  ex) sqlplus rivus/rivus_pass@orcl_net @go.sql
- 
  [[http://www.shift-the-oracle.com/sqlplus/tutorial/sqlplus-script.html][SQL*Plus を実行スクリプトファイルを指定して起動する - SHIFT the Oracle]]

*** インスタンスの状態確認
- 
  以下のコマンドで確認する。
  select STATUS from v$instance;
  ⇒
  shutdown : エラー(ORA-01034: ORACLE not available)
  nomount  : STARTED
  mount    : MOUNTED
  open     : open

- 
  [[http://ooltcloud.expressweb.jp/201212/article_18230921.html][【Oracle】データベースの状態の変更と確認方法 - オールトの雲]]

*** PLUSTRACEロール
- PLUSTRACEロールの作成方法
  @$ORACLE_HOME/sqlplus/admin/plustrce.sql
  
*** コメントの削除
- 
  削除コマンドは存在しないので、空文字で上書きすることとなる。
  COMMENT ON COLUMN table.column is '';

*** 出力行を抑制する
- 
  rownum擬似列を利用する。
  where rownum = 1とすると、1行のみ出力できる。行頭を見たい場合に利用している。
  where rownum < 11など、使い道
  
*** 明示カーソルと暗黙カーソル、カーソルFOR LOOP
- [[http://www.shift-the-oracle.com/plsql/cursor-loop.html][明示カーソルと暗黙カーソル - SHIFT the Oracle]]
- [[http://www.istudy.ne.jp/training/serial/plsql/010.html][第10回 「カーソルFORループ文」 - PL/SQLを使ってみよう！ iStudy]]

*** ProcedureとFunctionの違い
- 
  戻り値(RETURN句)の有無。
  ファンクションはプロシージャと異なり、SELECT expr FROM..のような形で含められる。

*** デフォルトパスワード
- 
  SYS : CHANGE_ON_INSTALL
  SYSTEM : MANAGER

- 
  [[http://otndnld.oracle.co.jp/document/products/oracle11g/111/doc_dvd/server.111/E05760-03/dba.htm#403635][DBAのセキュリティと権限の概要 - Oracle Database 管理者ガイド 11gリリース1（11.1）]]

*** Insert文の生成
- 
  DESCRIBEはsqlplusの文なので、pl/sqlから呼ぶことができないが、
  dba_tab_columnsなどに列情報が入っているので、その内容を元にクエリを構成可能。
*** SQL実行計画・統計情報を取得するための準備(PLUSTRACEなど)
- 
  [[http://www.sql-dbtips.com/performance-tuning/plustrace/][SQL実行計画・統計情報を取得するための準備 - Oracle使いのネタ帳]]
*** Listerの接続関係
- 
  リスナーは、同一リスナーで複数SIDを設定できるし、逆に複数リスナーで一つのSIDを見るように設定することも可能。
  ポートとインスタンスを接続するために存在するのみ、比較的それぞれ自由で疎結合。
*** 自動メンテナンスタスク
- 機能
  - 自動オプティマイザ機能
  - 自動セグメント・アドバイザ
  - 自動SQLチューニング・アドバイザ
** Link
*** Oracle 11.2
- [[http://docs.oracle.com/cd/E16338_01/nav/portal_booklist.htm][Oracle® Databaseオンライン・ドキュメント・ライブラリ 11g リリース2 (11.2) すべてのドキュメント]]
**** Install
- [[http://docs.oracle.com/cd/E16338_01/install.112/b56277/toc.htm][Oracle® Databaseクイック・インストレーション・ガイド 11gリリース2 (11.2) for Linux x86-64]]
- [[http://docs.oracle.com/cd/E16338_01/install.112/b56273/rev_precon_db.htm#BGECJCJI][Oracle® Databaseインストレーション・ガイド 11gリリース2 (11.2) for Linux]]
**** 概要
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56306/toc.htm][Oracle® Database概要 11gリリース2 (11.2)]]
**** Manage
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56301/toc.htm][Oracle® Database管理者ガイド 11gリリース2 (11.2)]]
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56320/toc.htm][Oracle® Database 2日でデータベース管理者 11gリリース2(11.2)]]
**** SQL言語
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56299/toc.htm][Oracle® Database SQL言語リファレンス 11gリリース2]]
**** SQL*Plus
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56314/toc.htm][SQL*Plus®ユーザーズ・ガイドおよびリファレンスリリース11.2]]
  
**** PL/SQL
- [[https://docs.oracle.com/cd/E16338_01/appdev.112/b56260/toc.htm][Oracle® Database PL/SQL言語リファレンス 11gリリース2 (11.2)]]
- [[https://docs.oracle.com/cd/E16338_01/appdev.112/b56262/toc.htm][Oracle® Database PL/SQLパッケージおよびタイプ・リファレンス 11g リリース2(11.2)]]
**** Reference
- [[https://docs.oracle.com/cd/E16338_01/server.112/b56311/toc.htm][Oracle® Databaseリファレンス 11gリリース2 (11.2)]]
  
*** Etc
- [[http://luna.gonna.jp/oracle/index.html][オラクル ちょこっとリファレンス]]
