Windows

* Batch

** Command

*** cls
- 
  画面上の文字を消去する。
  POSIX系shellだとclearかCtr+l。

*** choice

- choice[.exe] [/C <choices>] [/N] [/CS] [/T nnnn [/D c]] [/M <message>]
  - /C <choices>
    選択肢となる文字列を指定する。
  - /N
    選択肢と「？」を表示させない。
  - /CS
    選択肢の大文字小文字を区別する。
  - /T
    選択する時間を設定する。nnnnは制限時間の秒数。
  - /D
    Tで指定した時間が経過した際に選択される選択肢を指定する。
  - /M <message>
    メッセージを表示する。

- 1番目の選択肢を選ぶと1、n番目の選択肢を選ぶとnが終了コード（エラーコード）が返される。
  Ctrl+Cなどが押されると0、エラー時には255が返される。

- ex) choice /C YN /M "続行しますか"
      ⇒続行しますか [Y,N]?

*** defined
- 
  環境変数が設定されているかチェックするには、DEFINEDを使う。

- ex) 
    IF DEFINED ENV echo OK

[[http://orangeclover.hatenablog.com/entry/20110127/1296135692][バッチファイル/コマンドプロンプトで環境変数が設定されているかチェックする方法]]

*** fc
- fc (option) [file1] [file2]
  2つのファイルを比較して相違点を表示する。
- /L
  テキストファイルとして比較する。
- /B
  バイナリファイルとして比較する
- /A
  最初と最後の行のみ表示する
- /LB(行数)
  (行数)以上続いた場合に比較をやめる。

*** cacls
- 
  ファイルやフォルダに対して設定されているACLの内容を確認したり、
  変更するために利用するコマンドラインのツール。

*** help
- 
  コマンドの一覧を取得できる。
  内部コマンドも外部コマンドもあると思われる。

*** setlocal
- 
  バッチファイルでの環境変数のローカル化を開始する。
  以前の設定を復元するにはENDLOCALを実行する。
  バッチスクリプトが終了すると、そのバッチスクリプトで発行されたSETLOCALコマンドに対し、
  暗黙のENDLOCALが実行される。

*** endlocal
- 
  バッチプログラムで一時的に変更した環境変数のローカル化を終了する。

*** robocopy
- 
  フォルダを同期するためのコマンド。
  Robust File Copyの略で、堅牢で確実なファイル・コピーという意味を持つ。
  コマンドラインでなくGUIから使いたい場合は、richcopyが利用できる。

- source dest files (option)
  sourceがコピー元、destがコピー先、filesでコピーするファイルを指定する。
  filesはワイルドカード指定可能で、規定値は*.*。

- /S
  サブディレクトリをコピーするが、空のディレクトリはコピーしない。
  
- /E
  空のサブディレクトリを含むサブディレクトリをコピーする。

- /LEV:n
  コピー元ディレクトリツリーの上位nレベルのみをコピーする。

- /MIR
  2つのフォルダを同期させる。
  destファイルにsourceにないファイルがあれば削除し、古いファイルがあれば上書きされる。
  /purgeと/sを組み合わせた挙動と同じ。

- /COPY:コピーフラグ
  ファイルにコピーする情報
  D:データ、A:属性、T:タイムスタンプ

- /TS
  出力にコピー元ファイルのタイムスタンプを含める

- /FP
  出力にファイルの完全なパス名を含める

- /BYTES
  サイズをバイトで出力する

- /TEE
  コンソールウィンドウとログファイルに出力する

*** ネットワークコマンド

**** ping
- 
  ICMPのサブコマンドechoを使った、単純なパケット通信テストプログラム。
- -t
  中断されるまでホストをpingする
- -n 要求数
  送信するエコー要求数を設定する

**** tracert
- 
  実行するコンピュータから通信相手までの経路上にあるルータを一覧表示するコマンド。
  pingと同様ICMPのエコー要求・応答を利用している。
  TTLが1からスタートし、1つずつ大きくして経路上のルータを一覧表示する機能。

**** netstat
- 
  コンピュータの通信状況を一覧表示する。
  どのコンピュータとどんなプロトコルを使って何番ポートで通信しているかわかる。
  標準設定では、相手のコンピュータはホスト名、プロトコルはウェルノウンポートのプロトコル名で表示される。

- -n
  実行結果にコンピュータやプロトコル名を使わず、IPアドレスとポート番号で表示する

**** ipconfig
- 
  コンピュータのネットワーク設定情報を表示する

- /all
  すべてのNIC情報を表示する

- /release
  すべてのNICのIPv4のIPアドレスを開放する

- /renew
  すべてのNICのIPv4のIPアドレスを更新する

- /displaydns
  DNSリゾルバのキャッシュを表示する

- /flushdns
  DNSリゾルバのキャッシュをクリアする

**** arp
- 
  OSが管理しているAPRテーブルを表示したり削除したりするコマンド。
  ARPテーブルは、IPアドレスとMACアドレスを関連付けた一覧。

- -a
  ARPテーブルを表示する

- -d IPアドレス
  指定したIPアドレスのエントリーを削除する

**** netsh
- 
  netsh（ネットシェル）は、コンピュータのネットワーク設定情報を書き換えるコマンド。
  対話型と結果表示型、どちらも可能。

- ?
  コマンド一覧が表示される

- exit
  終了する

**** nslookup
- 
  DNSサーバと通信して名前解決の「正引き」や「逆引き」を行うコマンド。
  IPアドレスかドメイン名を入力する。

**** telnet
- 
  ネットワーク越しに別のコンピュータを操作するコマンド。
  Vista以降はコントロールパネルで有効化する必要がある。
  平文で送信されるので、使う範囲はLAN内に限定するべき。

**** net
- 
  ネットワーク関係の設定を行ったり、現在の状態を表示させたりするために使われるコマンド。
  サブコマンドをいれずに使うとサブコマンド一覧が表示される。
  [[http://www.atmarkit.co.jp/fwin2k/win2ktips/258netcommand/netcommand.html][netコマンドの使い方 - @IT]]
  [[http://pasofaq.jp/windows/command/net7.htm][NETコマンド(Windows 7)]]

***** net use
- 
  共有リソースの使用/解除。net shareされたネットワーク上のリソースをローカルで使う場合に使う。

***** net share
- 
  共有リソースの公開/公開停止。ローカルのリソースを公開して、外部のマシンでnet useできるようにする。

***** net view
- 
  リソースが共有されているマシンの列挙や、特定のマシンが公開している共有リソースの一覧を調べる

***** net file
- 
  使用されているファイルの一覧の表示/強制終了。
  net shareで公開されたリソースのうち、どのようなファイルが実際に外部マシンで利用されているか調べる。

***** net session
- 
  ユーザアカウントに対するログオンやパスワードの要件の表示/強制終了

***** net print

***** net user

***** net accounts

***** net group

***** net computer

***** net start
- 
  サービスの表示/開始

***** net stop
- 
  サービスの停止

***** net pause
- 
  サービスの一時停止

***** net continue
- 
  サービスの再開

***** net name
- 
  NetBIOS名の表示・追加。
  新しく追加された名前はnet sendコマンドの宛先として利用できる。

***** net send
- 指定されたユーザやコンピュータに対するメッセージの送信

***** net config
- 
  サーバ・サービスやワークステーション・サービスに関する情報の表示/設定

***** net sattistics
- 
  ネットワーク・プロトコルやリソースの公開/共有サービスに対する統計情報の表示

***** net time
- 
  時間情報の表示や外部との同期

***** net help
- 
  各コマンドの使い方の表示

***** net helpmsg
- 
  エラー番号に対する詳しいエラーメッセージの表示

**** nbtstat
- 
  Windowsネットワークを管理するためのコマンド。
  NBTとは"NetBIOS over TCP/IP"のこと。

- -c
  キャッシュしている情報を表示する

- -R
  キャッシュ内容をクリアする

- -n
  自分自身の情報を表示する

**** route
- 
  ルーティングテーブルに関する情報を表示、または変更する。
- -f
  デフォルトゲートウェイを含む全ての静的ルーティング情報を消去する。

- add|change|delete 宛先アドレス [mask ネットマスク] ゲートウェイ
  指定したルーティング情報を追加、変更、消去する。

- print
  ルーティング情報を表示する。

**** hostname
- 
  現在のホスト名を出力する

**** getmac
- 
  ネットワークにつながっている別のWindowsのMACアドレスを調べる。
  getmacを使うには管理者権限が必要なので、

- /s target /u username /p password
  サーバ名、管理者のユーザ名、パスワードを指定して、マックアドレスを確認する。

**** pathping
- 
  ノード間のネットワークの状態を確認する。
  pingとtracertを組み合わせたようなイメージ。

**** 外部link

- [[http://itpro.nikkeibp.co.jp/article/COLUMN/20060224/230618/][管理者必見！ネットワーク・コマンド集]]
- [[http://itpro.nikkeibp.co.jp/article/COLUMN/20131219/525889/][最重要ネットコマンド10]]
- [[http://blog.asial.co.jp/1157][使えると便利なWindowsネットワークコマンド]]


** etc

*** IF文の複数条件指定
- 

  ANDやORに相当する機能はない。ただし、AND条件であればIF文を並べて記述できる。
  ex:) IF %A% == 1 IF %B% == 2 (
         REM 1かつ2のAND条件
     ) ELSE (
         それ以外
     )

[[http://capm-network.com/?tag=Windows%E3%83%90%E3%83%83%E3%83%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%88%B6%E5%BE%A1%E6%A7%8B%E6%96%87][CapmNetwork Windowsバッチファイル制御構文]]


*** 処理の途中で改行を入れる
- 
  バッチファイルでのエスケープシーケンスは「^(hat)」なので、
  改行前に^をおくと複数行を1行として扱える。
  ex:) IF %ABCDEFGHIJKLM% ==1 ^
       IF %NOPQRSTUVWXYZ% ==2 (
         REM 処理
     )
[[http://orangeclover.hatenablog.com/entry/20100810/1281450669][みちしるべ バッチファイルで長い1行の処理を改行を入れて複数行に分けて書きたい]]
[[http://pf-j.sakura.ne.jp/program/dos/doscmd/str_circumflex.htm][ProgrammingField DOSコマンド一覧 ^(ハット記号)]]


*** 環境変数の消し方
- 
  "SET 変数="とする。
  たとえば変数XYZを初期化したければ、"set XYZ="でよい。
[[http://orangeclover.hatenablog.com/entry/20090826/1251293551][みちしるべ 3.環境変数 (1)環境変数の使い方 〜意外に削除の仕方はしらない人が多い〜 【コマンドプロンプト、バッチファイルを使わなきゃならなくなった人向けのメモ】]]


*** バッチでの標準入力待ち
- 
  "SET /P 変数=出力文字列"、という感じの構文。
  たとえば"set /P var=好きな英数字を入力してください。"とすると、
  "好きな英数字を入力してください。"と画面に出力された後入力待ちになり、
  改行するまでの文字列がvarに格納される。
  バッチファイルでユーザーに入力させた値を取得する


* memo

** ACL
- 
  アクセス制御リスト(Access Control List)。
  あるユーザやグループに対して、利用可能な権限を定義したものを
  アクセス制御エントリ(Access Control Entry : ACE)といい、
  これを集めたものがACLとなる。
  （正確には「随意アクセス制御リスト、Discretionary Access Control List:DACL」らしい。）
  [[http://www.atmarkit.co.jp/fwin2k/win2ktips/700whatisacl/whatisacl.html][アクセス制御リストACLとは？ - @IT]]

** cmdをエクスプローラから開く
- 
  エクスプローラからその場のcmdを開くには、
  アドレスバーにcmdと打つとOK。
** ローカルユーザで接続する
- 
  .\user、local\user、servername\user等でアクセスできる。
